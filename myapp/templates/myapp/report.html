{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <h2>Transaction Report</h2>

  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <label>Start Date</label>
      <input type="date" name="start_date" value="{{ start_date }}" class="form-control">
    </div>
    <div class="col-md-3">
      <label>End Date</label>
      <input type="date" name="end_date" value="{{ end_date }}" class="form-control">
    </div>
    <div class="col-md-3">
      <label>Account</label>
      <select name="account" class="form-control">
        <option value="">All</option>
        {% for acc in accounts %}
          <option value="{{ acc.id }}" {% if acc.id|stringformat:"s" == account_id %}selected{% endif %}>{{ acc.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label>Category</label>
      <select name="category" class="form-control">
        <option value="">All</option>
        {% for cat in categories %}
          <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == category_id %}selected{% endif %}>{{ cat.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-12 mt-3">
      <button type="submit" class="btn btn-primary">Generate Report</button>
    </div>
  </form>

  <h4>Summary</h4>
  <ul>
    <li>Total Transactions: {{ num_transactions }}</li>
    <li>Total Amount: {{ total_amount }}</li>
    <li>Average Transaction: {{ avg_amount|floatformat:2 }}</li>
  </ul>

  <h4 class="mt-4">Filtered Transactions</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>
          <a href="?sort=transaction_date&dir={{ toggle_dir }}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if account_id %}&account={{ account_id }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}">Date</a>
        </th>
        <th>
          <a href="?sort=account__name&dir={{ toggle_dir }}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if account_id %}&account={{ account_id }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}">Account</a>
        </th>
        <th>
          <a href="?sort=category__name&dir={{ toggle_dir }}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if account_id %}&account={{ account_id }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}">Category</a>
        </th>
        <th>
          <a href="?sort=amount&dir={{ toggle_dir }}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if account_id %}&account={{ account_id }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}">Amount</a>
        </th>
      </tr>
    </thead>
    <tbody>
      {% for t in transactions %}
      <tr>
        <td>{{ t.transaction_date }}</td>
        <td>{{ t.account.name }}</td>
        <td>{{ t.category.name }}</td>
        <td>{{ t.amount }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4" class="text-center">No transactions found for this filter.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
